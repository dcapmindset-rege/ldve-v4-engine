<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè∞ DevCapi‚Ñ¢ LDVE‚Ñ¢ v4 - Luxury Deal Vetting Engine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.32/jspdf.plugin.autotable.min.js"></script>
    <style>
        .phase-active { display: block !important; }
        .phase-hidden { display: none !important; }
        .nav-btn.active { background: linear-gradient(135deg, #3b82f6, #1d4ed8) !important; transform: scale(1.05); }
        .notification { position: fixed; top: 20px; right: 20px; z-index: 10000; transform: translateX(400px); transition: all 0.4s; }
        .notification.show { transform: translateX(0); }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-indigo-100 min-h-screen p-4 sm:p-8 font-sans">
    <div class="max-w-7xl mx-auto">
        <!-- HEADER -->
        <div class="text-center mb-12">
            <h1 class="text-5xl md:text-6xl font-black bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent mb-6">
                üè∞ DevCapi‚Ñ¢ LDVE‚Ñ¢ v4.0
            </h1>
            <p class="text-xl md:text-2xl text-gray-700 font-semibold max-w-3xl mx-auto">
                Luxury Deal Vetting Engine - Deal Intake ‚Üí Decision SOP
            </p>
        </div>

        <!-- METRICS -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
            <div class="bg-white p-8 rounded-3xl shadow-2xl text-center" id="metric1">
                <div class="text-4xl font-black text-indigo-600 mb-2" id="totalDeals">0</div>
                <div class="text-lg text-gray-600">Total Deals</div>
            </div>
            <div class="bg-white p-8 rounded-3xl shadow-2xl text-center" id="metric2">
                <div class="text-4xl font-black text-red-600 mb-2" id="phase0Rejects">0</div>
                <div class="text-lg text-gray-600">Phase 0 Kills</div>
            </div>
            <div class="bg-white p-8 rounded-3xl shadow-2xl text-center" id="metric3">
                <div class="text-4xl font-black text-emerald-600 mb-2" id="investable">0</div>
                <div class="text-lg text-gray-600">Investable</div>
            </div>
        </div>

        <!-- NAVIGATION -->
        <div class="grid grid-cols-1 xl:grid-cols-5 gap-8 mb-12">
            <div class="xl:col-span-1 space-y-4">
                <div class="bg-white rounded-3xl shadow-2xl p-8">
                    <h3 class="text-2xl font-bold mb-8 flex items-center gap-3">üî• Current Phase</h3>
                    <button class="w-full p-6 rounded-2xl font-bold text-xl bg-indigo-600 text-white nav-btn active mb-4" onclick="showPhase(1)">
                        üöÄ PHASE 1: Intake
                    </button>
                    <button id="phase2Btn" class="w-full p-6 rounded-2xl font-bold text-xl bg-gray-400 text-white disabled opacity-50 cursor-not-allowed mb-4" disabled>
                        ‚ö° PHASE 2: L1 Gate (LOCKED)
                    </button>
                    <button id="phase3Btn" class="w-full p-6 rounded-2xl font-bold text-xl bg-gray-400 text-white disabled opacity-50 cursor-not-allowed" disabled>
                        üéØ PHASE 3: 5-Pillar (LOCKED)
                    </button>
                </div>
            </div>

            <!-- PHASE CONTENT -->
            <div class="xl:col-span-4">
                <!-- PHASE 1: INTAKE -->
                <div id="phase1" class="phase-active bg-white rounded-4xl shadow-3xl p-12 border-4 border-indigo-100">
                    <h2 class="text-4xl font-bold text-gray-800 mb-12 text-center">üöÄ PHASE 1: DEAL INTAKE</h2>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div>
                            <label class="block text-xl font-bold mb-4">üè∑Ô∏è Deal Title *</label>
                            <input type="text" id="title" class="w-full p-6 text-lg border-2 border-gray-300 rounded-3xl focus:border-indigo-400 focus:ring-4" required>
                        </div>
                        <div>
                            <label class="block text-xl font-bold mb-4">üõ§Ô∏è Clear Pathway *</label>
                            <input type="text" id="pathway" class="w-full p-6 text-lg border-2 border-gray-300 rounded-3xl focus:border-indigo-400 focus:ring-4" required>
                        </div>
                        <div>
                            <label class="block text-xl font-bold mb-4">üí∞ Capital Asked ($M) *</label>
                            <input type="number" id="capital_asked" min="0" step="0.1" class="w-full p-6 text-lg border-2 border-gray-300 rounded-3xl focus:border-indigo-400 focus:ring-4" required>
                        </div>
                        <div>
                            <label class="block text-xl font-bold mb-4">‚úÖ Sponsor Verified? *</label>
                            <select id="sponsor_verified" class="w-full p-6 text-lg border-2 border-gray-300 rounded-3xl focus:border-indigo-400 focus:ring-4">
                                <option value="No">‚ùå No</option>
                                <option value="Yes">‚úÖ Yes</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="mt-12">
                        <label class="block text-xl font-bold mb-4">üìà Exit Logic *</label>
                        <textarea id="exit_logic" rows="4" class="w-full p-6 text-lg border-2 border-gray-300 rounded-3xl focus:border-indigo-400 focus:ring-4" required placeholder="Describe clear exit strategy..."></textarea>
                    </div>
                    
                    <div class="mt-12 text-center">
                        <button onclick="submitIntake()" class="px-20 py-8 text-2xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-4xl shadow-3xl hover:shadow-4xl hover:scale-105 transition-all duration-300">
                            üöÄ Submit to PHASE 0 Filter
                        </button>
                    </div>
                </div>

                <!-- RESULTS -->
                <div id="resultsArea" class="phase-hidden">
                    <div class="bg-white rounded-4xl shadow-3xl p-12 mb-12">
                        <h3 class="text-4xl font-bold mb-8 flex items-center gap-4">
                            üìä Deal Pipeline 
                            <button onclick="exportCSV()" class="ml-auto bg-green-600 text-white px-8 py-4 rounded-3xl font-bold text-xl hover:bg-green-700">
                                üì• Export CSV
                            </button>
                        </h3>
                        <div id="dealsTable" class="min-h-[200px]"></div>
                    </div>
                    
                    <div class="bg-emerald-50 rounded-4xl p-12 text-center">
                        <h3 class="text-3xl font-bold text-emerald-800 mb-8">üìÑ PHASE 6: IRM Generator</h3>
                        <button onclick="generateIRM()" class="bg-emerald-600 text-white px-16 py-8 rounded-4xl font-bold text-2xl shadow-3xl hover:shadow-4xl hover:scale-105">
                            üìã Generate IRM PDF
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // PRODUCTION-READY STATE (Vercel Compatible)
        let deals = JSON.parse(localStorage.getItem('ldve_deals') || '[]');
        let nextDealId = parseInt(localStorage.getItem('ldve_nextId') || '1');
        let rejectionStats = JSON.parse(localStorage.getItem('ldve_rejects') || '{"total":0,"phase0":0}');

        const MANDATE_MIN_CAPITAL = 5000000; // $5M

        // PHASE 0 AUTO-KILL (EXACT SOP)
        function phase0Filter(inputs) {
            const rejects = [];
            if (!inputs.title?.trim()) rejects.push("No title");
            if (!inputs.pathway?.trim()) rejects.push("No pathway");
            const capital = parseFloat(inputs.capital_asked || 0) * 1000000;
            if (capital < MANDATE_MIN_CAPITAL) rejects.push("Capital < $5M");
            if (inputs.sponsor_verified !== 'Yes') rejects.push("Unverified sponsor");
            if (!inputs.exit_logic?.trim()) rejects.push("No exit logic");

            if (rejects.length > 0) {
                rejectionStats.total++;
                rejectionStats.phase0++;
                localStorage.setItem('ldve_rejects', JSON.stringify(rejectionStats));
                return {
                    deal_id: nextDealId++,
                    title: inputs.title || 'Untitled',
                    status: "üö´ REJECTED (Phase 0)",
                    rejects: rejects,
                    capital_asked: inputs.capital_asked || 0,
                    timestamp: new Date().toISOString()
                };
            }
            localStorage.setItem('ldve_nextId', nextDealId++);
            return null;
        }

        // MAIN SUBMIT FUNCTION
        function submitIntake() {
            const inputs = {
                title: document.getElementById('title').value,
                pathway: document.getElementById('pathway').value,
                capital_asked: document.getElementById('capital_asked').value,
                sponsor_verified: document.getElementById('sponsor_verified').value,
                exit_logic: document.getElementById('exit_logic').value
            };

            const rejectData = phase0Filter(inputs);
            const dealData = rejectData || {
                ...inputs,
                deal_id: nextDealId - 1,
                status: "‚úÖ Phase 1 Complete",
                timestamp: new Date().toISOString()
            };

            deals.unshift(dealData);
            localStorage.setItem('ldve_deals', JSON.stringify(deals));
            
            updateDashboard();
            document.getElementById('intakeForm')?.reset?.();
            
            if (rejectData) {
                alert(`üö´ PHASE 0 REJECT: ${rejectData.rejects.join(', ')}`);
            } else {
                alert(`‚úÖ Deal #${dealData.deal_id} ‚Üí PHASE 2 READY!`);
                document.getElementById('phase2Btn').disabled = false;
                document.getElementById('phase2Btn').className = 'w-full p-6 rounded-2xl font-bold text-xl bg-emerald-600 text-white hover:bg-emerald-700 mb-4';
            }
        }

        // DASHBOARD UPDATE
        function updateDashboard() {
            document.getElementById('totalDeals').textContent = deals.length;
            document.getElementById('phase0Rejects').textContent = rejectionStats.phase0;
            document.getElementById('investable').textContent = deals.filter(d => !d.status.includes('REJECTED')).length;
            
            document.getElementById('resultsArea').classList.remove('phase-hidden');
            document.getElementById('resultsArea').classList.add('phase-active');
            renderDeals();
        }

        function renderDeals() {
            const container = document.getElementById('dealsTable');
            container.innerHTML = deals.map(deal => `
                <div class="p-8 rounded-3xl mb-6 shadow-2xl border-4 ${deal.status.includes('REJECTED') ? 'border-red-400 bg-red-50 text-red-800' : 'border-emerald-400 bg-emerald-50 text-emerald-800'}">
                    <div class="flex justify-between items-start">
                        <div>
                            <h4 class="text-2xl font-bold mb-2">Deal #${deal.deal_id}</h4>
                            <p class="text-lg">${deal.title || 'Untitled'}</p>
                        </div>
                        <div class="text-right">
                            <div class="text-3xl font-bold">${deal.status}</div>
                            <div>$${deal.capital_asked || 0}M</div>
                        </div>
                    </div>
                    ${deal.rejects ? `<p class="mt-4 p-3 bg-red-100 rounded-2xl text-sm">${deal.rejects.join(', ')}</p>` : ''}
                </div>
            `).join('') || '<p class="text-center py-12 text-gray-500 text-xl">No deals yet. Submit above! üëÜ</p>';
        }

        function exportCSV() {
            const csv = ['ID,Title,Status,Capital,Date', ...deals.map(d => 
                `${d.deal_id},"${d.title || ''}","${d.status}",${d.capital_asked || 0},"${new Date(d.timestamp).toLocaleString()}"`
            )].join('
');
            const a = document.createElement('a');
            a.href = 'data:text/csv;charset=utf-8,' + encodeURIComponent(csv);
            a.download = 'ldve_deals.csv';
            a.click();
        }

        function generateIRM() {
            if (deals.length === 0) return alert('Submit a deal first!');
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.text('LDVE‚Ñ¢ IRM REPORT', 20, 20);
            doc.text(`Latest Deal: #${deals[0].deal_id}`, 20, 40);
            doc.autoTable({
                startY: 60,
                head: [['Pillar', 'Status']],
                body: [['Phase 0 Filter', deals[0].status], ['Ready for L1 Gate', 'Pending']]
            });
            doc.save('IRM_latest.pdf');
        }

        function showPhase(n) {
            document.getElementById('phase1').classList.toggle('phase-hidden', n !== 1);
            document.getElementById('resultsArea').classList.toggle('phase-hidden', n !== 2);
        }

        // INIT
        updateDashboard();
    </script>
</body>
                        </html>
